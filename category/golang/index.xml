<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Golang | Luminolt</title><link>https://example.com/category/golang/</link><atom:link href="https://example.com/category/golang/index.xml" rel="self" type="application/rss+xml"/><description>Golang</description><generator>Wowchemy (https://wowchemy.com)</generator><language>en-us</language><lastBuildDate>Sun, 08 Aug 2021 00:52:13 +0800</lastBuildDate><image><url>https://example.com/media/icon_hu1b90dea3b5752ec4ed6154c0dc881a21_30314_512x512_fill_lanczos_center_3.png</url><title>Golang</title><link>https://example.com/category/golang/</link></image><item><title>Nil Map and Nil Slice in Golang</title><link>https://example.com/post/nil-map-and-nil-slice/</link><pubDate>Sun, 08 Aug 2021 00:52:13 +0800</pubDate><guid>https://example.com/post/nil-map-and-nil-slice/</guid><description>&lt;h2 id="前言">前言&lt;/h2>
&lt;p>我烂了&lt;/p>
&lt;h2 id="nil">Nil&lt;/h2>
&lt;p>&lt;code>Golang&lt;/code>的&lt;code>nil&lt;/code>是对于传统C系语言&lt;code>null&lt;/code>所做的一个安全性优化，笔者在学习&lt;code>map&lt;/code>和&lt;code>slice&lt;/code>有一些相关的疑惑。&lt;/p>
&lt;p>在如下代码运行后，&lt;code>map0&lt;/code>和&lt;code>slice0&lt;/code>的值均为&lt;code>nil&lt;/code>：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">map0&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">slice0&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>与之对应的是比较安全的建立方式，这种情况下建立的空&lt;code>map&lt;/code>和空&lt;code>slice&lt;/code>都非&lt;code>nil&lt;/code>值：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">map1&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">slice1&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="对map--nil">对&lt;code>map == nil&lt;/code>&lt;/h2>
&lt;p>对于&lt;code>map&lt;/code>增加键值对，前者会发生&lt;code>panic&lt;/code>，而后者可以：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">map0&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="nx">maths&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">60&lt;/span> &lt;span class="c1">//panic: assignment to entry in nil map
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">map1&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="nx">maths&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">60&lt;/span> &lt;span class="c1">//OK
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="对slice--nil">对&lt;code>slice == nil&lt;/code>&lt;/h2>
&lt;p>对于&lt;code>slice&lt;/code>的常规操作，则两者都可以进行：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">slice0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;maths&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">slice1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;maths&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">slice0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">slice1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">slice0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">slice1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="原因分析">原因分析&lt;/h2>
&lt;p>&lt;code>map&lt;/code>增加键值对的行为是在&lt;code>Golang&lt;/code>底层实现的，而&lt;code>slice&lt;/code>的&lt;code>append&lt;/code>,&lt;code>range&lt;/code>,&lt;code>len&lt;/code>操作都是在&lt;code>builtin&lt;/code>包内的函数实现的，对&lt;code>nil&lt;/code>值情况做了差错控制。&lt;/p>
&lt;h2 id="结论">结论&lt;/h2>
&lt;p>用&lt;code>make&lt;/code>，请。&lt;/p></description></item></channel></rss>